{% extends 'mentor-base.html' %}

{% block title %}Upload Chapter Quiz - Hustle Platform{% endblock %}

{% block mentor_content %}
<div class="container mt-4">
    <h2>Upload Quiz for Chapter</h2>

    <form method="POST">
        {% csrf_token %}
        <div class="form-group">
            <label for="resource">Select Course:</label>
            <select name="resource" id="resource" class="form-control">
                {% for resource in resources %}
                <option value="{{ resource.id }}">{{ resource.title }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="chapter">Select Chapter:</label>
            <select name="chapter" id="chapter" class="form-control">
                {% for chapter in chapters %}
                <option value="{{ chapter.id }}">{{ chapter.title }}</option>
                {% endfor %}
            </select>
        </div>

        <h4>AI-Generated Quiz Questions</h4>
        <div id="quiz-questions">
            <p class="text-muted">Click "Generate Quiz" to auto-generate 5 questions.</p>
        </div>

        <button type="button" class="btn btn-info" onclick="generateQuiz()">Generate Quiz</button>
        <button type="submit" class="btn btn-primary">Upload Quiz</button>
    </form>
</div>

<!-- JavaScript for AI Quiz Generation -->
<script>
    function generateQuiz() {
        let chapterId = document.getElementById("chapter").value;

        if (!chapterId) {
            alert("Please select a chapter first.");
            return;
        }

        document.getElementById("quiz-questions").innerHTML = "<p>Generating quiz... Please wait.</p>";

        fetch(`/api/ai-generate-chapter-quiz/${chapterId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let quizHTML = "";
                    data.questions.forEach((q, index) => {
                        quizHTML += `
                            <div class="border p-3 mb-3">
                                <h5>Question ${index + 1}</h5>
                                <input type="text" name="quiz_question_${index + 1}" class="form-control" value="${q.question}" required>
                                <input type="text" name="quiz_options_${index + 1}" class="form-control" value="${q.options.join(', ')}" required>
                                <input type="text" name="quiz_correct_answer_${index + 1}" class="form-control" value="${q.correct_answer}" required>
                            </div>
                        `;
                    });
                    document.getElementById("quiz-questions").innerHTML = quizHTML;
                } else {
                    document.getElementById("quiz-questions").innerHTML = "<p class='text-danger'>Failed to generate quiz. Try again.</p>";
                }
            })
            .catch(error => console.error("Error generating quiz:", error));
    }
</script>

{% endblock %}
